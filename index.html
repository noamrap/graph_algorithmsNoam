<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>××¢×¨×›×ª ×œ××™×“×ª ××œ×’×•×¨×™×ª××™× - × ×•×¢× ×¨×¤×•×¤×•×¨×˜</title>
    <style>
        /* --- THEME: DEEP LEARNING (Dark Academia / Cyber) --- */
        :root {
            --bg-core: #0f172a;
            --bg-sidebar: #1e293b;
            --border: #334155;
            --primary: #38bdf8;       /* Sky Blue */
            --accent: #f472b6;        /* Pink */
            --highlight: #facc15;     /* Yellow */
            --success: #4ade80;       /* Green */
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --font-ui: 'Segoe UI', system-ui, sans-serif;
            --font-mono: 'Consolas', 'Monaco', monospace;
        }

        * { box-sizing: border-box; outline: none; user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-core);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-rows: 1fr;
        }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease-in-out;
        }

        .royal-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 40px rgba(56, 189, 248, 0.2);
            backdrop-filter: blur(10px);
            animation: float 6s ease-in-out infinite;
        }

        .royal-title { color: var(--highlight); font-size: 1.5rem; margin-bottom: 10px; letter-spacing: 2px; }
        .royal-name { 
            font-size: 3.5rem; font-weight: 900; margin: 0;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .start-btn {
            margin-top: 30px; padding: 12px 40px; font-size: 1.2rem;
            background: var(--primary); color: #0f172a; border: none; border-radius: 30px;
            font-weight: bold; cursor: pointer; transition: transform 0.2s;
        }
        .start-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--primary); }

        /* --- MAIN INTERFACE --- */
        #app-interface {
            display: none; height: 100%; opacity: 0; transition: opacity 1s;
            grid-template-rows: 60px 1fr;
        }

        header {
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .brand-box { display: flex; flex-direction: column; }
        .brand-main { font-size: 1.2rem; font-weight: bold; color: white; }
        .brand-credit { font-size: 0.8rem; color: var(--primary); font-weight: bold; letter-spacing: 1px; }

        .nav-tabs { display: flex; gap: 8px; }
        .nav-btn {
            background: transparent; border: 1px solid var(--border); color: var(--text-muted);
            padding: 6px 14px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.9rem;
        }
        .nav-btn:hover { color: #fff; border-color: var(--text-muted); }
        .nav-btn.active { background: rgba(56, 189, 248, 0.15); color: var(--primary); border-color: var(--primary); }

        /* LAYOUT */
        .main-grid { display: grid; grid-template-columns: 1fr 450px; height: 100%; overflow: hidden; }

        /* GRAPH STAGE */
        .stage {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 30px 30px;
            position: relative; overflow: hidden;
        }
        svg { width: 100%; height: 100%; }

        .edge { stroke: #475569; stroke-width: 2; transition: 0.3s; }
        .edge.active { stroke: var(--highlight); stroke-width: 4; }
        .edge.visited { stroke: var(--primary); opacity: 0.6; }
        
        .label-bg { fill: var(--bg-core); stroke: var(--border); rx: 4; }
        .label-text { fill: var(--text-main); font-size: 12px; font-weight: bold; text-anchor: middle; dominant-baseline: central; font-family: var(--font-mono); }

        .node-circle { fill: var(--bg-sidebar); stroke: var(--text-muted); stroke-width: 3px; r: 28; transition: 0.3s; }
        .node-text { fill: white; font-size: 16px; font-weight: bold; text-anchor: middle; dominant-baseline: central; font-family: var(--font-mono); }
        
        .badge-text { font-size: 11px; fill: var(--highlight); font-weight: bold; text-anchor: middle; opacity: 0; font-family: var(--font-mono); }

        .group.active .node-circle { stroke: var(--highlight); fill: #422006; transform: scale(1.15); }
        .group.visited .node-circle { stroke: var(--primary); fill: #0c4a6e; }
        .group.finished .node-circle { stroke: var(--success); fill: #064e3b; }

        /* SIDEBAR */
        .sidebar {
            background: var(--bg-sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; box-shadow: -5px 0 20px rgba(0,0,0,0.5);
        }

        .panel-header {
            padding: 15px; border-bottom: 1px solid var(--border);
            font-size: 0.9rem; font-weight: bold; color: var(--primary); text-transform: uppercase;
            display: flex; justify-content: space-between; background: rgba(0,0,0,0.2);
        }

        /* DATA STRUCT */
        .ds-container { display: flex; gap: 8px; padding: 10px; overflow-x: auto; height: 60px; align-items: center; }
        .ds-item {
            min-width: 40px; height: 40px; background: var(--bg-core); border: 1px solid var(--border); border-radius: 6px;
            display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); font-weight: bold;
            color: var(--text-main); animation: popIn 0.3s;
        }
        .ds-item.active { border-color: var(--highlight); color: var(--highlight); transform: translateY(-3px); box-shadow: 0 2px 8px rgba(250, 204, 21, 0.2); }

        /* EXPLANATION LOG (IMPORTANT) */
        .log-wrapper { flex: 1; overflow-y: auto; padding: 15px; background: #020617; scroll-behavior: smooth; }
        .log-card {
            background: rgba(255,255,255,0.03); border-right: 4px solid transparent;
            border-radius: 6px; padding: 12px; margin-bottom: 10px;
            font-size: 0.95rem; line-height: 1.6; animation: slideIn 0.3s;
        }
        .log-card strong { color: #fff; font-family: var(--font-mono); }
        .log-card .math { color: var(--highlight); font-family: var(--font-mono); background: rgba(250, 204, 21, 0.1); padding: 2px 6px; border-radius: 4px; }
        
        .type-info { border-color: var(--text-muted); color: var(--text-muted); font-size: 0.9rem; font-style: italic; }
        .type-action { border-color: var(--primary); color: #e0f2fe; }
        .type-calc { border-color: var(--highlight); color: #fef9c3; }
        .type-success { border-color: var(--success); color: #dcfce7; background: rgba(74, 222, 128, 0.05); }
        .type-error { border-color: var(--accent); color: #fce7f3; }

        /* CONTROLS */
        .controls { padding: 20px; border-top: 1px solid var(--border); background: var(--bg-sidebar); }
        .slider-row { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px; }
        input[type=range] { width: 65%; cursor: pointer; accent-color: var(--primary); }
        
        .btn-row { display: flex; justify-content: center; gap: 15px; }
        .c-btn {
            border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
            font-family: var(--font-ui);
        }
        .btn-play { width: 60px; height: 60px; border-radius: 50%; background: var(--primary); font-size: 1.5rem; box-shadow: 0 0 15px rgba(56, 189, 248, 0.3); }
        .btn-play:hover { transform: scale(1.1); }
        
        .btn-step { padding: 10px 20px; background: var(--bg-core); border: 1px solid var(--text-muted); color: var(--text-main); gap: 8px; }
        .btn-step:hover { border-color: var(--highlight); color: var(--highlight); }
        
        .btn-reset { width: 40px; height: 40px; border-radius: 50%; background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-reset:hover { color: white; border-color: white; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }

    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="royal-card">
            <div class="royal-title">××¢×‘×“×ª ×”××œ×’×•×¨×™×ª××™×</div>
            <h1 class="royal-name">× ×•×¢× ×¨×¤×•×¤×•×¨×˜</h1>
            <p style="color:#aaa; margin-top:15px; font-size:1.1rem;">×”×”×¡×‘×¨×™× ×©×”××•×¨×” ×¨×¦×ª×”, ×•×”×¢×™×¦×•×‘ ×©××’×™×¢ ×œ×š.</p>
            <button class="start-btn" onclick="startApp()">×”×ª×—×œ ×œ×œ××•×“ ğŸ“</button>
        </div>
    </div>

    <div id="app-interface">
        <header>
            <div class="brand-box">
                <span class="brand-main">AlgoLab Pro</span>
                <span class="brand-credit">× ×•×¢× ×¨×¤×•×¤×•×¨×˜ Â© 2025</span>
            </div>
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="app.load('Dijkstra')">Dijkstra</button>
                <button class="nav-btn" onclick="app.load('BFS')">BFS</button>
                <button class="nav-btn" onclick="app.load('DFS')">DFS</button>
                <button class="nav-btn" onclick="app.load('SCC')">SCC</button>
                <button class="nav-btn" onclick="app.load('DAG')">DAG</button>
                <button class="nav-btn" onclick="app.load('Bellman')">Bellman</button>
            </div>
        </header>

        <div class="main-grid">
            <div class="stage">
                <svg id="svgLayer">
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="7" refX="32" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
                        <marker id="arrow-active" markerWidth="10" markerHeight="7" refX="32" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#facc15"/></marker>
                    </defs>
                    <g id="g-edges"></g>
                    <g id="g-nodes"></g>
                </svg>
            </div>

            <div class="sidebar">
                
                <div style="border-bottom: 1px solid var(--border);">
                    <div class="panel-header">
                        <span id="dsTitle">××‘× ×” × ×ª×•× ×™×</span>
                    </div>
                    <div class="ds-container" id="dsCont"></div>
                </div>

                <div class="panel-header">
                    <span>×œ×•×— ×”×¡×‘×¨×™× ×•×—×™×©×•×‘×™×</span>
                    <span style="font-size:0.7rem; cursor:pointer; color:var(--text-muted)" onclick="app.clearLog()">× ×§×”</span>
                </div>
                
                <div class="log-wrapper" id="logBox">
                    <div class="log-card type-info">×‘×¨×•×›×™× ×”×‘××™×! ×‘×—×¨ ××œ×’×•×¨×™×ª× ×œ××¢×œ×”.<br>×”×”×¡×‘×¨×™× ×™×•×¤×™×¢×• ×›××Ÿ ×‘×–××Ÿ ×××ª.</div>
                </div>

                <div class="controls">
                    <div class="slider-row">
                        <span>××”×™×¨×•×ª ×œ××™×“×”</span>
                        <input type="range" id="speedRange" min="100" max="2000" value="1000" step="100" dir="ltr">
                    </div>
                    <div class="btn-row">
                        <button class="c-btn btn-reset" onclick="app.reset()" title="××™×¤×•×¡">â†º</button>
                        <button class="c-btn btn-play" id="playBtn" onclick="app.toggleAuto()" title="××•×˜×•××˜×™">â–¶</button>
                        <button class="c-btn btn-step" onclick="app.manualStep()">×¦×¢×“ ×”×‘× âœ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* --- DATA --- */
        const SCENARIOS = {
            GENERAL: { // Generic graph
                nodes: [0,1,2,3,4,5],
                edges: [
                    {u:0,v:1,w:5},{u:0,v:2,w:2},{u:1,v:2,w:6},{u:1,v:3,w:1},{u:1,v:4,w:10},
                    {u:2,v:3,w:9},{u:2,v:4,w:1},{u:3,v:4,w:7},{u:3,v:5,w:1},{u:4,v:5,w:5},{u:5,v:1,w:2}
                ],
                pos: {0:{x:100,y:300},1:{x:300,y:150},2:{x:300,y:450},3:{x:600,y:150},4:{x:600,y:450},5:{x:800,y:300}}
            },
            DAG: { // From PDF (Topological Sort needed)
                nodes: [0,1,2,3,4,5],
                edges: [
                    {u:0,v:1,w:2},{u:0,v:2,w:6},{u:1,v:2,w:7},{u:1,v:3,w:4},{u:1,v:4,w:2},
                    {u:2,v:3,w:-1},{u:2,v:4,w:1},{u:3,v:4,w:-2},{u:4,v:5,w:2}
                ],
                pos: {0:{x:80,y:300},1:{x:250,y:150},2:{x:250,y:450},3:{x:500,y:150},4:{x:500,y:450},5:{x:700,y:300}}
            },
            BELLMAN: { // From PDF (Negative Edges)
                nodes: [1,2,3,4],
                edges: [
                    {u:1,v:2,w:4},{u:1,v:3,w:2},{u:2,v:3,w:1},{u:3,v:2,w:1},
                    {u:2,v:4,w:4},{u:3,v:4,w:2},{u:4,v:2,w:-2}
                ],
                pos: {1:{x:150,y:300},2:{x:450,y:150},3:{x:450,y:450},4:{x:750,y:300}}
            }
        };

        function startApp() {
            const s = document.getElementById('splash-screen');
            const a = document.getElementById('app-interface');
            s.style.opacity = 0;
            setTimeout(() => { s.style.display = 'none'; a.style.display = 'grid'; setTimeout(()=>a.style.opacity=1, 50); }, 800);
        }

        class App {
            constructor() {
                this.graph = SCENARIOS.GENERAL;
                this.algo = 'Dijkstra';
                this.gen = null;
                this.isPlaying = false;
                this.timer = null;
                
                this.ui = {
                    edges: document.getElementById('g-edges'),
                    nodes: document.getElementById('g-nodes'),
                    log: document.getElementById('logBox'),
                    ds: document.getElementById('dsCont'),
                    dsTitle: document.getElementById('dsTitle'),
                    playBtn: document.getElementById('playBtn'),
                    speed: document.getElementById('speedRange')
                };
                
                this.initGraph();
            }

            load(name) {
                this.algo = name;
                document.querySelectorAll('.nav-btn').forEach(b => {
                    b.classList.remove('active');
                    if(b.textContent === name) b.classList.add('active');
                });

                if(name === 'Bellman') this.graph = SCENARIOS.BELLMAN;
                else if(name === 'DAG') this.graph = SCENARIOS.DAG;
                else this.graph = SCENARIOS.GENERAL;

                this.reset();
            }

            /* --- VISUALS --- */
            initGraph() {
                this.ui.edges.innerHTML = '';
                this.ui.nodes.innerHTML = '';

                this.graph.edges.forEach(e => {
                    const u = this.graph.pos[e.u], v = this.graph.pos[e.v];
                    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                    g.innerHTML = `
                        <line x1="${u.x}" y1="${u.y}" x2="${v.x}" y2="${v.y}" class="edge" id="e-${e.u}-${e.v}" marker-end="url(#arrow)"></line>
                        <rect x="${(u.x+v.x)/2-10}" y="${(u.y+v.y)/2-10}" width="20" height="20" class="label-bg"></rect>
                        <text x="${(u.x+v.x)/2}" y="${(u.y+v.y)/2}" class="label-text">${e.w}</text>
                    `;
                    this.ui.edges.appendChild(g);
                });

                this.graph.nodes.forEach(n => {
                    const p = this.graph.pos[n];
                    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                    g.setAttribute("class", "group");
                    g.setAttribute("id", `n-${n}`);
                    g.setAttribute("transform", `translate(${p.x},${p.y})`);
                    g.innerHTML = `
                        <circle class="node-circle"></circle>
                        <text class="node-text">${n}</text>
                        <text class="badge-text" id="b-${n}" y="-40"></text>
                    `;
                    this.ui.nodes.appendChild(g);
                });
            }

            log(msg, type='type-info') {
                const div = document.createElement('div');
                div.className = `log-card ${type}`;
                div.innerHTML = msg;
                this.ui.log.appendChild(div);
                this.ui.log.scrollTop = this.ui.log.scrollHeight;
            }

            updateDS(items) {
                this.ui.ds.innerHTML = '';
                items.forEach(x => {
                    const el = document.createElement('div');
                    el.className = `ds-item`;
                    el.textContent = x;
                    this.ui.ds.appendChild(el);
                });
            }

            hlNode(id, state) {
                const el = document.getElementById(`n-${id}`);
                el.classList.remove('active', 'visited', 'finished');
                if(state) el.classList.add(state);
            }

            hlEdge(u, v, on) {
                const el = document.getElementById(`e-${u}-${v}`);
                if(!el) return;
                if(on) { el.classList.add('active'); el.setAttribute('marker-end', 'url(#arrow-active)'); }
                else { el.classList.remove('active'); el.setAttribute('marker-end', 'url(#arrow)'); }
            }

            badge(id, text) {
                const el = document.getElementById(`b-${id}`);
                el.textContent = text; el.style.opacity = 1;
            }

            /* --- CONTROL LOGIC --- */
            reset() {
                this.stopAuto();
                this.ui.log.innerHTML = '';
                this.initGraph();
                this.updateDS([]);
                
                if(this.algo === 'Dijkstra') this.gen = this.runDijkstra();
                else if(this.algo === 'BFS') this.gen = this.runBFS();
                else if(this.algo === 'DFS') this.gen = this.runDFS();
                else if(this.algo === 'SCC') this.gen = this.runSCC();
                else if(this.algo === 'DAG') this.gen = this.runDAG();
                else if(this.algo === 'Bellman') this.gen = this.runBellman();
                
                this.log(`×”××œ×’×•×¨×™×ª× <strong>${this.algo}</strong> × ×˜×¢×Ÿ. ××•×›×Ÿ ×œ×”×ª×—×œ×”.`);
            }

            toggleAuto() {
                if(this.isPlaying) this.stopAuto(); else this.startAuto();
            }

            startAuto() {
                if(!this.gen) this.reset();
                this.isPlaying = true;
                this.ui.playBtn.textContent = 'â¸';
                this.loop();
            }

            stopAuto() {
                this.isPlaying = false;
                clearTimeout(this.timer);
                this.ui.playBtn.textContent = 'â–¶';
            }

            manualStep() {
                if(this.isPlaying) this.stopAuto();
                this.step();
            }

            step() {
                if(!this.gen) return false;
                const res = this.gen.next();
                if(res.done) { this.stopAuto(); return false; }
                return true;
            }

            loop() {
                if(!this.isPlaying) return;
                if(this.step()) {
                    const delay = 2100 - this.ui.speed.value;
                    this.timer = setTimeout(() => this.loop(), delay);
                }
            }

            /* --- ALGORITHMS WITH EDUCATIONAL LOGS --- */
            
            *runDijkstra() {
                const start = this.graph.nodes[0];
                this.ui.dsTitle.innerText = "×ª×•×¨ ×¢×“×™×¤×•×™×•×ª (Priority Queue)";
                const d={}, Q=new Set(this.graph.nodes);
                this.graph.nodes.forEach(n=>{ d[n]=Infinity; }); d[start]=0;
                this.badge(start, '0');
                
                this.log(`××ª×—×™×œ×™× ×‘-<strong>${start}</strong>. ××ª×—×•×œ ×›×œ ×”××¨×—×§×™× ×œ-$\infty$.`);

                while(Q.size > 0) {
                    let u=null, min=Infinity;
                    Q.forEach(n=>{ if(d[n]<min){min=d[n];u=n;} });
                    
                    if(u===null) break;
                    Q.delete(u);
                    this.hlNode(u, 'active');
                    this.updateDS(Array.from(Q));
                    
                    this.log(`× ×‘×—×¨ ×§×•×“×§×•×“ <strong>${u}</strong> ×›×™ ×”××¨×—×§ ××œ×™×• ×”×•× ×”××™× ×™××œ×™ ×‘×ª×•×¨: <span class="math">${min}</span>.`, 'type-action');
                    yield;

                    const neighbors = this.graph.edges.filter(e=>e.u===u);
                    for(let e of neighbors) {
                        if(!Q.has(e.v)) continue;
                        this.hlEdge(e.u, e.v, true);
                        
                        const alt = d[u] + e.w;
                        const currentV = d[e.v] === Infinity ? 'âˆ' : d[e.v];
                        
                        this.log(`×‘×•×“×§ ×©×›×Ÿ <strong>${e.v}</strong>.<br>
                                  ×”××¡×œ×•×œ ×“×¨×š ${u}: <span class="math">${d[u]} + ${e.w} = ${alt}</span>.<br>
                                  ×”××¨×—×§ ×”×™×©×Ÿ: <span class="math">${currentV}</span>.`);
                        yield;

                        if(alt < d[e.v]) {
                            d[e.v] = alt;
                            this.badge(e.v, `d:${alt}`);
                            this.log(`× ××¦× ×©×™×¤×•×¨! (Relaxation)<br>×”××¨×—×§ ×œ-<strong>${e.v}</strong> ×¢×•×“×›×Ÿ ×œ-<span class="math">${alt}</span>.`, 'type-success');
                        } else {
                            this.log(`××™×Ÿ ×©×™×¤×•×¨. ${alt} ×’×“×•×œ ××• ×©×•×•×” ×œ-${currentV}.`);
                        }
                        this.hlEdge(e.u, e.v, false);
                    }
                    this.hlNode(u, 'visited');
                }
                this.log("×”××œ×’×•×¨×™×ª× ×”×¡×ª×™×™×. ×”××¨×—×§×™× ×—×•×©×‘×•.", 'type-success');
            }

            *runBFS() {
                const start = this.graph.nodes[0];
                this.ui.dsTitle.innerText = "×ª×•×¨ (Queue FIFO)";
                const Q=[start], visited=new Set([start]);
                this.log(`×¡×¨×™×§×” ×œ×¨×•×—×‘. ××ª×—×™×œ×™× ×‘×ª×•×¨: [${start}].`);

                while(Q.length) {
                    this.updateDS([...Q]);
                    const u = Q.shift();
                    this.hlNode(u, 'active');
                    this.log(`××•×¦×™× ××ª <strong>${u}</strong> ××¨××© ×”×ª×•×¨.`, 'type-action');
                    yield;

                    const neighbors = this.graph.edges.filter(e=>e.u===u).map(e=>e.v);
                    for(let v of neighbors) {
                        if(!visited.has(v)) {
                            this.hlEdge(u, v, true);
                            visited.add(v); Q.push(v);
                            this.updateDS([...Q]);
                            this.log(`×’×™×œ×•×™ ×©×›×Ÿ ×—×“×© <strong>${v}</strong> -> ×”×•×¡×¤×” ×œ×¡×•×£ ×”×ª×•×¨.`, 'type-calc');
                            yield;
                            this.hlEdge(u, v, false);
                        }
                    }
                    this.hlNode(u, 'visited');
                }
                this.log("×”×ª×•×¨ ×¨×™×§. ×”×¡×¨×™×§×” ×”×¡×ª×™×™××”.", 'type-success');
            }

            *runDFS() {
                const start = this.graph.nodes[0];
                this.ui.dsTitle.innerText = "××—×¡× ×™×ª (Stack LIFO)";
                const S=[start], visited=new Set();
                this.log(`×¡×¨×™×§×” ×œ×¢×•××§. ×“×•×—×£ ×œ××—×¡× ×™×ª ××ª <strong>${start}</strong>.`);

                while(S.length) {
                    const u = S.pop();
                    if(!visited.has(u)) {
                        visited.add(u);
                        this.hlNode(u, 'active');
                        this.updateDS([...S, u]);
                        this.log(`×‘×™×§×•×¨ ×‘×¦×•××ª <strong>${u}</strong> (×”×•×¦××” ××”××—×¡× ×™×ª).`, 'type-action');
                        yield;

                        const neighbors = this.graph.edges.filter(e=>e.u===u).map(e=>e.v).reverse();
                        for(let v of neighbors) {
                            if(!visited.has(v)) S.push(v);
                        }
                        this.hlNode(u, 'visited');
                    }
                }
                this.log("×”××—×¡× ×™×ª ×¨×™×§×”. ×¡×™×•×.", 'type-success');
            }

            *runBellman() {
                const start = this.graph.nodes[0];
                const n = this.graph.nodes.length;
                this.ui.dsTitle.innerText = "××™×˜×¨×¦×™×” × ×•×›×—×™×ª";
                const d={}; this.graph.nodes.forEach(n=>{d[n]=Infinity; this.badge(n,'âˆ');});
                d[start]=0; this.badge(start,'0');

                this.log(`×‘×œ××Ÿ-×¤×•×¨×“: ××‘×¦×¢×™× |V|-1 ××™×˜×¨×¦×™×•×ª (${n-1}). ×××¤×©×¨ ××©×§×œ×™× ×©×œ×™×œ×™×™×.`);

                for(let i=1; i<n; i++) {
                    this.log(`--- ××™×˜×¨×¦×™×” ××¡×¤×¨ ${i} ---`, 'type-action');
                    this.updateDS([`i=${i}`]);
                    let changed = false;

                    for(let e of this.graph.edges) {
                        this.hlEdge(e.u, e.v, true);
                        this.hlNode(e.u, 'active');
                        
                        // Explanation
                        const distU = d[e.u] === Infinity ? 'âˆ' : d[e.u];
                        const distV = d[e.v] === Infinity ? 'âˆ' : d[e.v];
                        
                        if(d[e.u] !== Infinity && d[e.u] + e.w < d[e.v]) {
                            d[e.v] = d[e.u] + e.w;
                            this.badge(e.v, `d:${d[e.v]}`);
                            this.log(`×©×™×¤×•×¨ ×‘×§×©×ª (${e.u},${e.v}): <span class="math">${distU} + (${e.w}) = ${d[e.v]}</span> (×”×™×” ${distV}).`, 'type-success');
                            changed = true;
                        }
                        yield;
                        this.hlEdge(e.u, e.v, false);
                        this.hlNode(e.u, '');
                    }
                    if(!changed) {
                        this.log("×œ× ×‘×•×¦×¢×• ×©×™× ×•×™×™× ×‘××™×˜×¨×¦×™×” ×–×•. × ×™×ª×Ÿ ×œ×¢×¦×•×¨ ××•×§×“×.", 'type-info');
                        break;
                    }
                }
                
                this.log("×‘×“×™×§×ª ××¢×’×œ×™× ×©×œ×™×œ×™×™×...", 'type-calc');
                for(let e of this.graph.edges) {
                    if(d[e.u] !== Infinity && d[e.u] + e.w < d[e.v]) {
                        this.log("×©×’×™××”: × ××¦× ××¢×’×œ ×©×œ×™×œ×™ ×‘×’×¨×£!", 'type-error');
                        return;
                    }
                }
                this.log("×”××œ×’×•×¨×™×ª× ×”×¡×ª×™×™× ×‘×”×¦×œ×—×”.", 'type-success');
            }

            *runDAG() {
                const start = this.graph.nodes[0];
                this.ui.dsTitle.innerText = "××™×•×Ÿ ×˜×•×¤×•×œ×•×’×™";
                this.log("×©×œ×‘ 1: ×—×™×©×•×‘ ×¡×“×¨ ×˜×•×¤×•×œ×•×’×™ (Topological Sort).<br>×–×” ××‘×˜×™×— ×©× ×¢×‘×“ ×”×•×¨×™× ×œ×¤× ×™ ×™×œ×“×™×.");
                
                const inDegree={}; this.graph.nodes.forEach(n=>inDegree[n]=0);
                this.graph.edges.forEach(e=>inDegree[e.v]++);
                const q = this.graph.nodes.filter(n=>inDegree[n]===0);
                const topo = [];

                while(q.length) {
                    const u = q.shift();
                    topo.push(u);
                    this.updateDS(topo);
                    this.hlNode(u, 'finished');
                    yield;
                    this.graph.edges.filter(e=>e.u===u).forEach(e=>{
                        inDegree[e.v]--;
                        if(inDegree[e.v]===0) q.push(e.v);
                    });
                }

                this.log(`×¡×“×¨ ×˜×•×¤×•×œ×•×’×™ × ×§×‘×¢: [${topo.join(', ')}]. ×›×¢×ª × ×—×©×‘ ××¨×—×§×™×.`, 'type-action');
                this.graph.nodes.forEach(n=>this.hlNode(n, ''));
                
                const d={}; this.graph.nodes.forEach(n=>d[n]=Infinity); d[start]=0;
                this.badge(start, '0');

                for(let u of topo) {
                    if(d[u]===Infinity) continue;
                    this.hlNode(u, 'active');
                    this.log(`××¢×‘×“ ××ª ×¦×•××ª <strong>${u}</strong> ×œ×¤×™ ×”×¡×“×¨.`, 'type-action');
                    yield;

                    const neighbors = this.graph.edges.filter(e=>e.u===u);
                    for(let e of neighbors) {
                        this.hlEdge(u, e.v, true);
                        const alt = d[u] + e.w;
                        const old = d[e.v] === Infinity ? 'âˆ' : d[e.v];
                        
                        if(alt < d[e.v]) {
                            d[e.v] = alt;
                            this.badge(e.v, `d:${d[e.v]}`);
                            this.log(`Relax(${u}->${e.v}): <span class="math">${d[u]} + ${e.w} = ${alt}</span> < ${old}.`, 'type-success');
                        }
                        yield;
                        this.hlEdge(u, e.v, false);
                    }
                    this.hlNode(u, 'visited');
                }
                this.log("×¡×™×•×. ×¢×‘×¨× ×• ×¢×œ ×›×œ ×”×¦××ª×™× ×‘×¡×“×¨ ×˜×•×¤×•×œ×•×’×™.", 'type-success');
            }

            *runSCC() {
                this.ui.dsTitle.innerText = "××—×¡× ×™×ª ×¨×§×•×¨×¡×™×”";
                let ids={}, low={}, stack=[], onStack={}, id=0, sccCount=0;
                const visited=new Set();
                const that = this;
                this.log("××œ×’×•×¨×™×ª× Tarjan ×œ××¦×™××ª ×¨×›×™×‘×™× ×§×©×™×¨×™× ×”×™×˜×‘ (SCC).");

                function* dfs(at) {
                    stack.push(at); onStack[at]=true; visited.add(at);
                    ids[at]=low[at]=id++;
                    that.hlNode(at, 'active');
                    that.badge(at, `L:${low[at]}`);
                    that.updateDS(stack);
                    that.log(`×‘×™×§×•×¨ ×‘×¦×•××ª <strong>${at}</strong>.<br>××¡×¤×¨ ×¡×™×“×•×¨×™ (id): ${ids[at]}, Low Link: ${low[at]}.`);
                    yield;

                    const neighbors = that.graph.edges.filter(e=>e.u===at);
                    for(let e of neighbors) {
                        if(!visited.has(e.v)) {
                            that.hlEdge(at,e.v,true);
                            yield* dfs(e.v);
                            low[at] = Math.min(low[at], low[e.v]);
                            that.badge(at, `L:${low[at]}`);
                            that.log(`×—×–×¨×” ×œ-${at}. ×¢×“×›×•×Ÿ Low ×œ×¤×™ ×”×‘×Ÿ ${e.v} -> <span class="math">${low[at]}</span>.`, 'type-calc');
                            that.hlNode(at, 'active');
                            yield;
                            that.hlEdge(at,e.v,false);
                        } else if(onStack[e.v]) {
                            low[at] = Math.min(low[at], ids[e.v]);
                            that.badge(at, `L:${low[at]}`);
                            that.log(`${e.v} × ××¦× ×‘××—×¡× ×™×ª (×§×©×ª ××—×•×¨×™×ª). ×¢×“×›×•×Ÿ Low ×œ-<span class="math">${low[at]}</span>.`, 'type-calc');
                            yield;
                        }
                    }

                    if(ids[at] === low[at]) {
                        that.log(`<strong>${at}</strong> ×”×•× ×©×•×¨×© ×©×œ SCC! (×›×™ id == low). ××¨×•×§×Ÿ ××—×¡× ×™×ª...`, 'type-success');
                        while(stack.length) {
                            const node = stack.pop();
                            onStack[node] = false;
                            document.getElementById(`n-${node}`).setAttribute('data-scc', sccCount%3);
                            that.updateDS(stack);
                            if(node === at) break;
                            yield;
                        }
                        sccCount++;
                    }
                }

                for(let n of this.graph.nodes) {
                    if(!visited.has(n)) yield* dfs(n);
                }
                this.log(`×¡×™×•×. × ××¦××• ${sccCount} ×¨×›×™×‘×™× ×§×©×™×¨×™×.`, 'type-success');
            }
        }

        const app = new App();
    </script>
</body>
</html>
